---
title: "Analyse des Disparit√©s de Pauvret√© en Tunisie"
subtitle: "Comparaison Enqu√™te Nationale vs Recensement G√©n√©ral (2023)"
author: "Mazzez Mohamed Amine"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    theme: cerulean # tu peux le Changer par "flatly", "cosmo", "darkly", "yeti", "superhero", "united", etc.
    highlight: tango
    code_folding: show
    number_sections: true
    css: styles.css
    #includes:
    #  in_header: header.html
---

<style>
body {
  font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 15px;
}

/* Titres sobres */
h1, h2, h3 {
  color: #1a4f6d;
}
h1 {
  font-size: 2.1em;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}
h2 {
  font-size: 1.6em;
  border-bottom: 2px solid #1a4f6d;
  padding-bottom: 0.25em;
  margin-top: 1.5em;
}
h3 {
  font-size: 1.25em;
  margin-top: 1.2em;
}

/* Paragraphes */
p {
  line-height: 1.6;
}

/* Tableaux */
table {
  width: 100%;
  border-collapse: collapse;
  margin: 1.5em 0;
  font-size: 0.95em;
}
th, td {
  padding: 0.7em 0.9em;
  border-bottom: 1px solid #e0e6ed;
}
thead {
  background-color: #1a4f6d;
  color: white;
}

/* Blocs Conclusion / R√©sultats */
.block {
  background-color: #f7fafc;
  border-left: 4px solid #2f855a;
  padding: 1.1em 1.3em;
  margin: 1.2em 0;
  border-radius: 3px;
}

/* TOC un peu plus lisible */
#TOC {
  font-size: 0.9em;
}
#TOC h2 {
  font-size: 1.1em;
  margin-bottom: 0.6em;
}
</style>

# Introduction

## Contexte

Ce rapport pr√©sente une analyse statistique et g√©ographique approfondie des **taux de pauvret√© en Tunisie** au niveau des **24 gouvernorats**. L'objectif principal est de **comparer deux sources de donn√©es majeures** :

::: {.block .block-info}
1. **L'Enqu√™te Nationale sur le Budget, la Consommation et le Niveau de Vie** (m√©thode par √©chantillon)
2. **Le Recensement G√©n√©ral de la Population et de l'Habitat** (m√©thode exhaustive)
:::

## Objectifs

- ‚úì √âvaluer la **coh√©rence statistique** entre les deux mesures
- ‚úì Identifier les **gouvernorats o√π les √©carts sont significatifs**
- ‚úì Cartographier les **disparit√©s spatiales de la pauvret√©**
- ‚úì Analyser les **5 Districts administratifs** (d√©coupage r√©gional)
- ‚úì Tester l'existence d'un **biais syst√©matique** entre les sources

---

# Pr√©paration de l'Environnement

```{r packages}
# Nettoyage de la session
rm(list = ls())
graphics.off()

# Chargement des packages
library(tidyverse)  # Manipulation de donn√©es et visualisation
library(sf)         # Donn√©es spatiales
library(tmap)       # Cartographie th√©matique
library(broom)      # Export des r√©sultats de r√©gression

# D√©sactiver s2 pour √©viter les erreurs g√©om√©triques
sf::sf_use_s2(FALSE)
```

---

# Import et Nettoyage des Donn√©es

## Import des donn√©es brutes

```{r import}
# Import du fichier CSV
raw_pauv <- read.csv2("pauvrete.csv", 
                      sep = ";", 
                      dec = ".", 
                      header = FALSE, 
                      stringsAsFactors = FALSE)

# Aper√ßu
head(raw_pauv, 10)
dim(raw_pauv)
```

## Construction du DataFrame propre

```{r cleaning}
# Suppression des 3 premi√®res lignes (en-t√™tes complexes)
pauv <- raw_pauv[-c(1:3), ]

# Renommage des colonnes
colnames(pauv) <- c("Gouvernorat", 
                    "Taux_enquete", "Ecart_type_enquete", "IC95_bas", "IC95_haut", 
                    "Taux_recensement", "Ecart_type_recensement", "Diff_absolue")

# Conversion des types
pauv <- pauv %>%
  mutate(
    Gouvernorat = factor(Gouvernorat),
    across(Taux_enquete:Diff_absolue, as.numeric),
    Gouv_clean = toupper(as.character(Gouvernorat))
  ) %>%
  mutate(Gouv_clean = ifelse(str_detect(Gouv_clean, "KEF"), "LE KEF", Gouv_clean))

# V√©rification
str(pauv)
summary(pauv)
```

---

# Cr√©ation des Variables D√©riv√©es

```{r derived_vars}
pauv <- pauv %>%
  mutate(
    # Largeur de l'intervalle de confiance
    Largeur_IC = IC95_haut - IC95_bas,
    
    # Diff√©rence absolue et relative
    Diff = Taux_recensement - Taux_enquete,
    Diff_relatif = Diff / Taux_recensement,
    
    # Coh√©rence : recensement dans l'IC de l'enqu√™te ?
    Recensement_dans_IC = (Taux_recensement >= IC95_bas) & (Taux_recensement <= IC95_haut)
  )

# R√©sum√© de la coh√©rence
table(pauv$Recensement_dans_IC)
```

**R√©sultat** : `r sum(pauv$Recensement_dans_IC)` gouvernorats sur 24 ont un taux de recensement coh√©rent avec l'intervalle de confiance de l'enqu√™te.

---

# Statistiques Descriptives

## R√©sum√© global

```{r stats_desc}
summary_select <- pauv %>%
  select(Taux_enquete, Taux_recensement, Diff, Diff_relatif, Largeur_IC)

summary(summary_select)

# Statistiques d√©taill√©es
desc_stats <- summary_select %>%
  summarise(
    across(
      everything(),
      list(
        mean = ~ mean(., na.rm = TRUE),
        median = ~ median(., na.rm = TRUE),
        sd = ~ sd(., na.rm = TRUE),
        min = ~ min(., na.rm = TRUE),
        max = ~ max(., na.rm = TRUE)
      ),
      .names = "{.col}_{.fn}"
    )
  )

knitr::kable(desc_stats, digits = 2, caption = "Statistiques descriptives d√©taill√©es")
```

## Comparaison visuelle : Boxplots

```{r boxplot, fig.height=5}
pauv_long_taux <- pauv %>%
  select(Gouvernorat, Taux_enquete, Taux_recensement) %>%
  pivot_longer(cols = c(Taux_enquete, Taux_recensement), 
               names_to = "Source", 
               values_to = "Taux")

ggplot(pauv_long_taux, aes(x = Source, y = Taux, fill = Source)) +
  geom_boxplot(alpha = 0.7) +
  scale_fill_manual(values = c("#D73027", "#4575B4")) +
  labs(title = "Distribution des taux de pauvret√©",
       x = "Source", y = "Taux de pauvret√© (%)") +
  theme_minimal() +
  theme(legend.position = "none")
```

---

# Visualisations Comparatives

## Barplot : Enqu√™te vs Recensement

```{r barplot, fig.height=8}
pauv <- pauv %>%
  mutate(Gouvernorat = fct_reorder(Gouvernorat, Taux_enquete))

ggplot(pauv, aes(x = Gouvernorat)) +
  geom_col(aes(y = Taux_enquete, fill = "Enqu√™te"), alpha = 0.6) +
  geom_point(aes(y = Taux_recensement, color = "Recensement"), size = 3) +
  coord_flip() +
  scale_fill_manual(values = "#D73027") +
  scale_color_manual(values = "#4575B4") +
  labs(title = "Taux de Pauvret√© : Enqu√™te (Barres) vs Recensement (Points)",
       x = "", y = "Taux de Pauvret√© (%)") +
  theme_minimal()
```

## Nuage de points : Corr√©lation

```{r scatterplot, fig.height=7}
ggplot(pauv, aes(x = Taux_enquete, y = Taux_recensement)) +
  geom_point(color = "darkblue", size = 3, alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", fill = "red", alpha = 0.2) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "gray50") +
  geom_text(aes(label = Gouvernorat), hjust = -0.1, vjust = 0.5, size = 2.5,
            data = pauv %>% slice_max(abs(Diff), n = 5)) +
  labs(title = "Relation Enqu√™te vs Recensement",
       subtitle = "Ligne pointill√©e : √©galit√© parfaite (y = x)",
       x = "Taux Enqu√™te (%)", y = "Taux Recensement (%)") +
  theme_minimal()
```

---

# Analyse de la Coh√©rence Statistique

## Test des Intervalles de Confiance

```{r ic_plot, fig.height=8}
ggplot(pauv, aes(x = reorder(Gouvernorat, Taux_recensement), y = Taux_recensement)) +
  geom_errorbar(aes(ymin = IC95_bas, ymax = IC95_haut), width = 0.4, color = "gray60") +
  geom_point(aes(color = Recensement_dans_IC), size = 3) +
  coord_flip() +
  scale_color_manual(values = c("FALSE" = "red", "TRUE" = "forestgreen"),
                     labels = c("Divergence", "Coh√©rent")) +
  labs(title = "Coh√©rence Statistique : Recensement vs IC Enqu√™te",
       subtitle = "Rouge = Le recensement est hors de l'IC de l'enqu√™te",
       x = "", y = "Taux (%)") +
  theme_minimal()
```

**Gouvernorats en divergence** (hors IC) :

```{r divergence}
pauv %>% 
  filter(!Recensement_dans_IC) %>% 
  select(Gouvernorat, Taux_enquete, Taux_recensement, Diff) %>%
  arrange(desc(abs(Diff))) %>%
  knitr::kable(digits = 2)
```

---

# Mod√®le de R√©gression Lin√©aire

## Ajustement du mod√®le

```{r regression}
modele_lin <- lm(Taux_recensement ~ Taux_enquete, data = pauv)
summary(modele_lin)

# Extraction des param√®tres
cor_pearson <- cor(pauv$Taux_enquete, pauv$Taux_recensement)
r_squared <- summary(modele_lin)$r.squared
```

**√âquation du mod√®le** :  
\[
\text{Taux Recensement} = `r round(coef(modele_lin)[1], 2)` + `r round(coef(modele_lin)[2], 2)` \times \text{Taux Enqu√™te}
\]

**Interpr√©tation** :

- **Corr√©lation de Pearson** : `r round(cor_pearson, 3)` ‚Üí Tr√®s forte corr√©lation
- **R¬≤** : `r round(r_squared, 3)` ‚Üí Le mod√®le explique `r round(r_squared*100, 1)`% de la variance

## Visualisation avec droite de r√©gression

```{r regression_plot, fig.height=7}
ggplot(pauv, aes(x = Taux_enquete, y = Taux_recensement)) +
  geom_point(color = "darkblue", size = 3, alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", fill = "red", alpha = 0.2, formula = y ~ x) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "gray50", linewidth = 1) +
  labs(title = "Mod√®le Lin√©aire : Recensement vs Enqu√™te",
       subtitle = paste("R¬≤ =", round(r_squared, 3), "| Corr√©lation =", round(cor_pearson, 3)),
       x = "Taux Enqu√™te (%)", y = "Taux Recensement (%)") +
  theme_minimal()
```

---

# Test de la Diff√©rence Moyenne (Test t Appari√©)

```{r t_test}
test_t <- t.test(pauv$Taux_recensement, pauv$Taux_enquete, paired = TRUE, conf.level = 0.95)
test_t

# Extraction des r√©sultats
mean_diff <- test_t$estimate
p_value_t <- test_t$p.value
```

**R√©sultats** :

- **Diff√©rence moyenne** : `r round(mean_diff, 2)` points de pourcentage
- **p-value** : `r format.pval(p_value_t, digits = 3)`

**Interpr√©tation** :

```{r interpretation, echo=FALSE, results='asis'}
if (p_value_t < 0.05) {
  cat("‚úó **R√©sultat SIGNIFICATIF** (p < 0.05) :\n\n")
  cat("Il y a une diff√©rence statistique r√©elle entre les deux mesures.\n\n")
  if (mean_diff > 0) {
    cat("Le Recensement tend √† donner des taux **PLUS √âLEV√âS** que l'Enqu√™te.\n")
  } else {
    cat("Le Recensement tend √† donner des taux **PLUS FAIBLES** que l'Enqu√™te.\n")
  }
} else {
  cat("‚úì **R√©sultat NON SIGNIFICATIF** (p ‚â• 0.05) :\n\n")
  cat("La diff√©rence observ√©e n'est **pas statistiquement diff√©rente de 0**.\n\n")
  cat("Les deux m√©thodes ne pr√©sentent **pas de biais syst√©matique** l'une par rapport √† l'autre.\n")
}
```

## Distribution des diff√©rences

```{r diff_density, fig.height=5}
ggplot(pauv, aes(x = Diff)) +
  geom_density(fill = "lightblue", alpha = 0.5) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "red", linewidth = 1) +
  geom_vline(xintercept = mean_diff, color = "darkblue", linewidth = 1) +
  labs(title = "Distribution des Diff√©rences (Recensement - Enqu√™te)",
       subtitle = paste("Moyenne =", round(mean_diff, 2), "| p-value =", format.pval(p_value_t, digits = 3)),
       x = "Diff√©rence (Points %)", y = "Densit√©") +
  theme_minimal()
```

---

# Cartographie des Disparit√©s

## Import et pr√©paration des donn√©es spatiales

```{r spatial_setup}
# Import du GeoJSON
gouv_sf <- st_read("decoupage.geojson.json", quiet = TRUE)

# Harmonisation des noms
gouv_sf <- gouv_sf %>%
  mutate(Gouv_clean = toupper(gov_name_f)) %>%
  mutate(Gouv_clean = case_when(
    Gouv_clean == "SILIANA"       ~ "SELIANA",   
    Gouv_clean == "KEF"           ~ "LE KEF",    
    Gouv_clean == "MANUBAH"       ~ "MANOUBA",
    Gouv_clean == "B√âJA"          ~ "BEJA",
    Gouv_clean == "JENDOUBA"      ~ "JENDOUBA",
    Gouv_clean == "KASS√âRINE"     ~ "KASSERINE",
    Gouv_clean == "SIDI BOU ZID"  ~ "SIDI BOUZID",
    Gouv_clean == "GAB√àS"         ~ "GABES",
    Gouv_clean == "M√âDENINE"      ~ "MEDNINE",
    Gouv_clean == "TATAOUINE"     ~ "TATAOUINE",
    TRUE ~ Gouv_clean
  ))

# Jointure avec les donn√©es de pauvret√©
carte_pauv <- gouv_sf %>% left_join(pauv, by = "Gouv_clean")

# D√©finition des 5 districts
districts_5 <- data.frame(
  Gouvernorat = c("BIZERTE", "BEJA", "JENDOUBA", "LE KEF",
                  "TUNIS", "ARIANA", "BEN AROUS", "MANOUBA", "ZAGHOUAN", "NABEUL",
                  "SELIANA", "SOUSSE", "KASSERINE", "KAIROUAN", "MONASTIR", "MAHDIA",
                  "TOZEUR", "SIDI BOUZID", "SFAX", "GAFSA",
                  "TATAOUINE", "GABES", "MEDNINE", "KEBILI"),
  District = c(rep("D1: Nord-Ouest", 4), rep("D2: Nord-Est/Tunis", 6),
               rep("D3: Centre", 6), rep("D4: Sud-Ouest/Centre-Est", 4),
               rep("D5: Sud-Est", 4))
)
districts_5$Gouv_clean <- toupper(districts_5$Gouvernorat)

# Cr√©ation de la g√©om√©trie des districts
sf_districts <- gouv_sf %>%
  left_join(districts_5, by = "Gouv_clean") %>%
  st_make_valid() %>%
  group_by(District) %>%
  summarise(geometry = st_union(geometry)) %>%
  left_join(
    pauv %>% left_join(districts_5, by = "Gouv_clean") %>%
      group_by(District) %>%
      summarise(
        Moyenne_Enquete = mean(Taux_enquete, na.rm = TRUE),
        Moyenne_Recensement = mean(Taux_recensement, na.rm = TRUE),
        .groups = "drop"
      ),
    by = "District"
  )
```

## Cartes choropl√®thes : Enqu√™te et Recensement

```{r cartes_enquete_recensement}
# Activation du mode tmap
tmap_mode("plot")

# Carte 1 : Enqu√™te
m1 <- tm_shape(carte_pauv) +
  tm_polygons("Taux_enquete", palette = "Reds", title = "Taux_enquete (%)",
              breaks = seq(0, 35, by = 5)) +
  tm_layout(title = "Pauvret√© (Enqu√™te)", frame = TRUE)

# Carte 2 : Recensement
m2 <- tm_shape(carte_pauv) +
  tm_polygons("Taux_recensement", palette = "Blues", title = "Taux_recensement (%)",
              breaks = seq(0, 35, by = 5)) +
  tm_layout(title = "Pauvret√© (Recensement)", frame = TRUE)

# Affichage c√¥te √† c√¥te
tmap_arrange(m1, m2)
```

**Figure** : R√©partition g√©ographique des taux de pauvret√©. √Ä gauche : donn√©es de l'Enqu√™te. √Ä droite : donn√©es du Recensement.

## Carte des divergences

```{r carte_difference}
# Cr√©er une variable pour les divergences avec seuil statistique
carte_pauv <- carte_pauv %>%
  mutate(
    Coherence = Recensement_dans_IC,
    Diff_cat = case_when(
      Diff > 5 ~ "√âcart > 5pts",
      Diff >= 0 ~ "0 ‚â§ √âcart ‚â§ 5pts",
      Diff >= -5 ~ "-5pts ‚â§ √âcart < 0",
      TRUE ~ "√âcart < -5pts"
    )
  )

# Carte des diff√©rences
tm_shape(carte_pauv) +
  tm_polygons("Diff", palette = "RdYlBu", title = "Diff√©rence (pts %)",
              midpoint = 0, breaks = seq(-6, 6, by = 2)) +
  tm_layout(title = "√âcart Recensement - Enqu√™te", frame = TRUE)
```

**Figure** : √âcart entre les taux du Recensement et de l'Enqu√™te par gouvernorat. Les zones oranges indiquent que le Recensement mesure des taux plus √©lev√©s que l'Enqu√™te. Les zones violettes indiquent l'inverse.

## Carte de coh√©rence statistique

```{r carte_coherence}
# Cr√©er une palette pour coh√©rence
carte_pauv <- carte_pauv %>%
  mutate(Coherence_char = ifelse(Coherence, "Coh√©rent", "Divergence"))

tm_shape(carte_pauv) +
  tm_polygons("Coherence_char", palette = c("Coh√©rent" = "forestgreen", "Divergence" = "red"),
              title = "Coh√©rence") +
  tm_text("Gouv_clean", size = 0.5, fontface = "bold") +
  tm_layout(title = "Validit√© Statistique", frame = TRUE)
```

**Figure** : Validit√© statistique. En vert : le taux du Recensement est coh√©rent avec l'intervalle de confiance de l'Enqu√™te. En rouge : divergence significative.

---

# Analyse par Districts (5 R√©gions)

## Tableau des districts

```{r table_districts}
pauv_dist_data <- pauv %>%
  left_join(districts_5, by = "Gouv_clean") %>%
  group_by(District) %>%
  summarise(
    Moyenne_Enquete = mean(Taux_enquete, na.rm = TRUE),
    Moyenne_Recensement = mean(Taux_recensement, na.rm = TRUE),
    .groups = "drop"
  )

knitr::kable(pauv_dist_data, digits = 2, caption = "Taux moyens de pauvret√© par District")
```

## Cartes des Districts

```{r cartes_districts}
# Carte 1 : Districts Enqu√™te
d1 <- tm_shape(sf_districts) +
  tm_polygons("Moyenne_Enquete", palette = "Reds", title = "Taux moyen (%)",
              breaks = seq(5, 30, by = 5)) +
  tm_text("District", size = 0.6, fontface = "bold") +
  tm_layout(title = "Pauvret√© par District (Enqu√™te)", frame = TRUE)

# Carte 2 : Districts Recensement
d2 <- tm_shape(sf_districts) +
  tm_polygons("Moyenne_Recensement", palette = "Blues", title = "Taux moyen (%)",
              breaks = seq(5, 30, by = 5)) +
  tm_text("District", size = 0.6, fontface = "bold") +
  tm_layout(title = "Pauvret√© par District (Recensement)", frame = TRUE)

# Affichage c√¥te √† c√¥te
tmap_arrange(d1, d2)
```

**Figure** : Taux moyens de pauvret√© par District. √Ä gauche : Enqu√™te. √Ä droite : Recensement. Le d√©coupage en 5 Districts r√©v√®le des disparit√©s r√©gionales marqu√©es : le Nord-Ouest (D1) et le Centre (D3) sont les plus pauvres, tandis que le Nord-Est/Tunis (D2) est le moins touch√©.

---

# Conclusion

## Principaux r√©sultats

::: {.block .block-success}
1. **Corr√©lation forte** entre enqu√™te et recensement (r = `r round(cor_pearson, 3)`)
2. **`r sum(!pauv$Recensement_dans_IC)` gouvernorats** pr√©sentent des divergences significatives
3. **Pas de biais syst√©matique** global (p = `r format.pval(p_value_t, digits = 3)`)
4. **Disparit√©s r√©gionales** : le Nord-Est/Tunis moins pauvre que l'int√©rieur
:::

## Recommandations

- üîç Investiguer les gouvernorats en **divergence** (KAIROUAN, BEJA, MAHDIA, MEDNINE, TATAOUINE)
- üìä Harmoniser les **m√©thodologies** de collecte de donn√©es
- üéØ Utiliser les **cartes** pour cibler les politiques sociales

Les r√©sultats montrent que malgr√© quelques divergences locales, les deux m√©thodes convergent globalement, **validant ainsi la robustesse des estimations de pauvret√© en Tunisie**.

---

**Auteur** : Mazzez Mohamed Amine  
**Date** : `r Sys.Date()`  
**Outils** : R 4.5.1, RStudio, tidyverse, sf, tmap
